<div class="flex h-screen ">
  <!-- Mobile Overlay -->
  <div *ngIf="mobileMenuOpen$ | async" (click)="closeMobileMenu()" class="fixed inset-0 bg-black/50 z-40 lg:hidden">
  </div>

  <!-- Sidebar -->
  <aside [class]="(sidebarCollapsed$ | async) ? 'w-16' : 'w-64'"
    class="bg-base-100 border-base-100 transition-all duration-300 flex flex-col fixed lg:static h-full z-50 lg:z-auto"
    [class.-translate-x-full]="!(mobileMenuOpen$ | async)" [class.translate-x-0]="mobileMenuOpen$ | async"
    [class.lg:translate-x-0]="true">

    <!-- Sidebar Header -->
    <div class="mt-4 p-4 px-3 flex items-center">
      <button (click)="navTo('/home')" aria-label="Home"
        class="shadow-none flex items-center btn btn-sm cursor-pointer w-full text-start gap-1"
        [ngClass]="(sidebarCollapsed$ | async) ? 'p-1 btn-soft' : 'p-2 btn-ghost '">
        <span class="material-symbols-outlined">
          cardiology
        </span>
        <span *ngIf="!(sidebarCollapsed$ | async)" class="font-semibold text-base">iBozzi</span>
      </button>

    </div>
    <div class="divider m-0 px-4"></div>

    <!-- Sidebar Content -->
    <ul class="flex-1 py-4 menu w-full" [class.px-3]="!(sidebarCollapsed$ | async)"
      [class.px-auto]="sidebarCollapsed$ | async">

      <li class="mb-2" *ngIf="!(user$ | async)?.admin">
        <a (click)="alertDemoData.showModal()" [class.justify-center]="sidebarCollapsed$ | async"
          class="btn btn-warning btn-sm shadow-none">
          <ng-container *ngIf="!isLoading">
            <span class="material-symbols-outlined">
              cached
            </span>
            <span *ngIf="!(sidebarCollapsed$ | async)">{{'layout.reloadData' | t}}</span>
          </ng-container>

          <span *ngIf="isLoading" class="loading loading-spinner loading-md"></span>

        </a>

      </li>

      <li (click)="navTo('/dashboard')">
        <a [class.justify-center]="sidebarCollapsed$ | async">
          <span class="material-symbols-outlined">
            dashboard
          </span>
          <span *ngIf="!(sidebarCollapsed$ | async)">{{'layout.dashboard' | t}}</span>
        </a>
      </li>

      <li (click)="navTo('/units')">
        <a [class.justify-center]="sidebarCollapsed$ | async">
          <span class="material-symbols-outlined">
            apartment
          </span>
          <span *ngIf="!(sidebarCollapsed$ | async)">{{'layout.units' | t}}</span>
        </a>
      </li>

      <li (click)="navTo('/tenants')">
        <a [class.justify-center]="sidebarCollapsed$ | async">
          <span class="material-symbols-outlined">
            group
          </span>
          <span *ngIf="!(sidebarCollapsed$ | async)">{{'layout.tenants' | t}}</span>
        </a>
      </li>

      <li (click)="navTo('/payments')">
        <a [class.justify-center]="sidebarCollapsed$ | async">
          <span class="material-symbols-outlined">
            payments
          </span>
          <span *ngIf="!(sidebarCollapsed$ | async)">{{'layout.payments' | t}}</span>
        </a>
      </li>

    </ul>

    <!-- Sidebar Footer -->
    <div class="p-4 pb-6 flex flex-col items-center gap-2">

      <div *ngIf="!(user$ | async)?.admin" class="badge badge-warning "
        [ngClass]="(sidebarCollapsed$ | async) ? 'p-1' : 'p-2'">
        <span class="!text-lg material-symbols-outlined">
          experiment
        </span>
        {{!(sidebarCollapsed$ | async) ? ('layout.demonstrative' | t) : ''}}
      </div>

      <button tabindex="0" class="shadow-none btn btn-ghost" (click)="navTo('/profile')"
        [class.btn-circle]="sidebarCollapsed$ | async" [class.w-full]="!(sidebarCollapsed$ | async)">
        <div *ngIf="!(sidebarCollapsed$ | async)" class="flex gap-3 w-full items-center">
          <div class="avatar avatar-placeholder">
            <div class="bg-neutral text-neutral-content size-8 rounded-full">
              <span *ngIf="!(user$ | async)?.photoURL" class="material-symbols-outlined">
                person
              </span>

              <img *ngIf="(user$ | async)?.photoURL" class="rounded-full" [src]="(user$ | async)?.photoURL" alt="">
            </div>
          </div>
          <div class="flex flex-col items-start flex-1 min-w-0">
            <span class="text-sm font-medium truncate w-full">{{(user$ | async)?.displayName ? (user$ |
              async)?.displayName :
              'layout.noName' | t}}</span>
            <span class="text-xs text-base-content/60 truncate w-full">{{(user$ | async)?.email}}</span>
          </div>
        </div>

        <div *ngIf="sidebarCollapsed$ | async" class="avatar avatar-placeholder">
          <div class="bg-neutral text-neutral-content size-8 rounded-full">
            <span *ngIf="!(user$ | async)?.photoURL" class="material-symbols-outlined">
              person
            </span>

            <img *ngIf="(user$ | async)?.photoURL" class="rounded-full" [src]="(user$ | async)?.photoURL" alt="">
          </div>
        </div>
      </button>
    </div>
  </aside>

  <!-- Main Content Area -->
  <div class="flex-1 flex flex-col w-full lg:w-auto h-full overflow-hidden">
    <!-- Header -->
    <div class="bg-base-300 mt-4 mr-4 mb-4 lg:ml-0 ml-4 card flex flex-col flex-1 overflow-hidden">
      <header *ngIf="showHeader" class="px-4 lg:px-6 pt-4 pb-2 flex-shrink-0"
        [ngClass]="isRegister ? ' bg-neutral/60 pb-4' : ''">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <button aria-label="Abrir menu" (click)="openMobileMenu()"
              class="shadow-none btn btn-circle rounded-xl lg:hidden" [ngClass]="isRegister ? '' : ' btn-ghost'">
              <span class="material-symbols-outlined">
                menu
              </span>
            </button>

            <button aria-label="Abrir menu" (click)="toggleSidebar()"
              class="shadow-none btn btn-sm btn-circle rounded-xl hidden lg:flex"
              [ngClass]="isRegister ? '' : ' btn-ghost'">
              <span class="material-symbols-outlined">
                menu
              </span>
            </button>

            <div class="divider divider-horizontal py-2 m-0"></div>
            <h1 class="font-semibold" *ngIf="!isBreadCrumb">{{ headerTitle ? (headerTitle | t) : ('home.title' | t) }}
            </h1>
            <div class="flex items-center gap-2" *ngIf="isBreadCrumb">
              <ng-container *ngFor="let item of breadCrumbItems; let last = last">
                <h1 (click)="navTo(item.url)" class="link link-hover font-semibold">
                  {{ item.label | t }}
                </h1>
                <span class="material-symbols-outlined text-sm" *ngIf="!last">
                  chevron_right
                </span>
              </ng-container>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="flex-1 overflow-hidden min-h-0">
        <router-outlet />
      </main>
    </div>
  </div>
</div>

<dialog #alertDemoData class="modal">
  <div class="modal-box">
    <h3 class="text-lg font-bold">{{'layout.reloadDataConfirm' | t}}</h3>
    <p class="py-4">{{'layout.reloadDataWarning' | t}}</p>
    <div class="modal-action">
      <form method="dialog" class="flex gap-2">
        <button type="button" class="btn btn-ghost" (click)="alertDemoData.close()">{{ 'layout.cancel' | t }}</button>
        <button type="button" class="btn btn-warning" (click)="realodData(); alertDemoData.close()">
          {{ 'layout.confirm' | t }}
        </button>
      </form>
    </div>
  </div>
</dialog>